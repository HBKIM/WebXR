<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR 정육면체 뷰어</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #girl-image {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            z-index: 1000;
            border: 2px solid white;
            border-radius: 50%;
        }
        #enterVR {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            z-index: 1000;
        }
        #enterVR:hover {
            background-color: #45a049;
        }
        #info {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background-color: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            z-index: 1000;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/XRControllerModelFactory.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/XRTargetRaySpace.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/XRControllerModelFactory.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/webxr/VRButton.js"></script>
</head>
<body>
    <img id="girl-image" src="girl.png" alt="Girl">
    <div id="info">정육면체 중앙에 위치해 있습니다. VR 모드를 시작하세요.</div>
    <button id="enterVR">VR 모드 시작</button>

    <script>
        // Three.js와 WebXR 변수
        let xrSession = null;
        let cube = null;
        let scene = null;
        let renderer = null;
        let camera = null;
        let controller = null;

        // 장면 초기화 함수
        function initScene() {
            const canvas = document.createElement('canvas');
            document.body.appendChild(canvas);
            
            // Three.js 장면 설정
            scene = new THREE.Scene();
            
            // 카메라 설정
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 0);
            
            // 렌더러 설정
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            
            // 정육면체 생성
            const geometry = new THREE.BoxGeometry(2, 2, 2);
            const materials = [
                new THREE.MeshBasicMaterial({ color: 0xff0000 }), // 오른쪽 (빨강)
                new THREE.MeshBasicMaterial({ color: 0x00ff00 }), // 왼쪽 (초록)
                new THREE.MeshBasicMaterial({ color: 0x0000ff }), // 위쪽 (파랑)
                new THREE.MeshBasicMaterial({ color: 0xffff00 }), // 아래쪽 (노랑)
                new THREE.MeshBasicMaterial({ color: 0xff00ff }), // 앞쪽 (분홍)
                new THREE.MeshBasicMaterial({ color: 0x00ffff })  // 뒤쪽 (시안)
            ];
            
            cube = new THREE.Mesh(geometry, materials);
            cube.position.set(0, 0, -3); // 카메라 앞에 위치시킴
            scene.add(cube);
            
            // VR 버튼 설정
            document.body.appendChild(THREE.VRButton.createButton(renderer));
            
            // VR 모드 시작 버튼 이벤트
            document.getElementById('enterVR').addEventListener('click', function() {
                if (renderer.xr.isPresenting) {
                    renderer.xr.getSession().end();
                } else {
                    renderer.xr.getSession().then(onSessionStarted);
                }
            });
            
            // 창 크기 조정 이벤트
            window.addEventListener('resize', onWindowResize);
            
            // 애니메이션 시작
            renderer.setAnimationLoop(render);
        }
        
        // 세션 시작 시 호출되는 함수
        function onSessionStarted(session) {
            xrSession = session;
            
            // 세션 종료 이벤트 리스너
            session.addEventListener('end', onSessionEnded);
            
            // VR 컨트롤러 설정
            if (controller === null) {
                controller = renderer.xr.getController(0);
                controller.addEventListener('selectstart', onSelectStart);
                controller.addEventListener('selectend', onSelectEnd);
                scene.add(controller);
            }
            
            document.getElementById('info').textContent = "VR 모드가 활성화되었습니다. 스마트폰을 움직여 보세요.";
        }
        
        // 세션 종료 시 호출되는 함수
        function onSessionEnded() {
            xrSession = null;
            document.getElementById('info').textContent = "VR 모드가 종료되었습니다. 다시 시작하려면 버튼을 누르세요.";
        }
        
        // 컨트롤러 선택 시작
        function onSelectStart() {
            // 선택 동작 처리 (필요시 구현)
        }
        
        // 컨트롤러 선택 종료
        function onSelectEnd() {
            // 선택 동작 처리 (필요시 구현)
        }
        
        // 창 크기 변경 처리
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // 렌더링 함수
        function render() {
            if (cube) {
                cube.rotation.x += 0.005;
                cube.rotation.y += 0.01;
            }
            renderer.render(scene, camera);
        }
        
        // WebXR 사용 가능 여부 확인
        if ('xr' in navigator) {
            navigator.xr.isSessionSupported('immersive-vr').then(function(supported) {
                if (supported) {
                    initScene();
                } else {
                    document.getElementById('info').textContent = "이 브라우저는 WebXR VR을 지원하지 않습니다.";
                    document.getElementById('enterVR').style.display = 'none';
                }
            });
        } else {
            document.getElementById('info').textContent = "이 브라우저는 WebXR을 지원하지 않습니다.";
            document.getElementById('enterVR').style.display = 'none';
        }
    </script>
</body>
</html>
