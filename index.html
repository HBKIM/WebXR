<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <title>WebXR 정육면체 뷰어</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }
        #girl-image {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            z-index: 1000;
            border: 2px solid white;
            border-radius: 50%;
        }
        #enterVR {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        #enterVR:hover {
            background-color: #45a049;
        }
        #info {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background-color: rgba(0,0,0,0.7);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
            width: 80%;
            max-width: 400px;
            font-size: 16px;
        }
        #unsupported {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            background-color: rgba(255,0,0,0.7);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
            width: 80%;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/webxr/VRButton.js"></script>
</head>
<body>
    <img id="girl-image" src="girl.png" alt="Girl">
    <div id="info">정육면체 중앙에 위치해 있습니다.<br>VR 모드를 시작하려면 아래 버튼을 누르세요.</div>
    <div id="unsupported">죄송합니다. 이 기기/브라우저는 WebXR VR을 지원하지 않습니다.<br>최신 버전의 Chrome 또는 Firefox를 사용해 보세요.</div>
    <button id="enterVR">VR 모드 시작</button>

    <script>
        // Three.js와 WebXR 변수
        let cube = null;
        let scene = null;
        let renderer = null;
        let camera = null;
        let vrButton = null;

        // WebXR 지원 여부 확인
        function checkXRSupport() {
            if (!navigator.xr) {
                document.getElementById('unsupported').style.display = 'block';
                document.getElementById('enterVR').style.display = 'none';
                document.getElementById('info').style.display = 'none';
                return false;
            }
            return true;
        }

        // 장면 초기화 함수
        function initScene() {
            const canvas = document.createElement('canvas');
            document.body.appendChild(canvas);
            
            // Three.js 장면 설정
            scene = new THREE.Scene();
            
            // 카메라 설정
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.6, 0); // 사람 눈 높이로 조정
            
            // 렌더러 설정
            renderer = new THREE.WebGLRenderer({ 
                canvas, 
                antialias: true,
                alpha: true
            });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            
            // 정육면체 생성 (안쪽에서 보이도록 뒤집음)
            const geometry = new THREE.BoxGeometry(10, 10, 10);
            const materials = [
                new THREE.MeshBasicMaterial({ color: 0xff0000, side: THREE.BackSide }), // 오른쪽
                new THREE.MeshBasicMaterial({ color: 0x00ff00, side: THREE.BackSide }), // 왼쪽
                new THREE.MeshBasicMaterial({ color: 0x0000ff, side: THREE.BackSide }), // 위쪽
                new THREE.MeshBasicMaterial({ color: 0xffff00, side: THREE.BackSide }), // 아래쪽
                new THREE.MeshBasicMaterial({ color: 0xff00ff, side: THREE.BackSide }), // 앞쪽
                new THREE.MeshBasicMaterial({ color: 0x00ffff, side: THREE.BackSide })  // 뒤쪽
            ];
            
            cube = new THREE.Mesh(geometry, materials);
            scene.add(cube);
            
            // VR 버튼 생성
            vrButton = THREE.VRButton.createButton(renderer);
            vrButton.id = 'real-vr-button';
            vrButton.style.display = 'none'; // 처음에는 숨김
            document.body.appendChild(vrButton);
            
            // VR 모드 시작 버튼 이벤트
            document.getElementById('enterVR').addEventListener('click', function() {
                // 실제 VR 버튼 클릭 트리거
                vrButton.click();
            });
            
            // XR 세션 상태 변경 감지
            renderer.xr.addEventListener('sessionstart', () => {
                document.getElementById('info').textContent = "VR 모드가 활성화되었습니다!\n기기를 움직여 보세요.";
                document.getElementById('enterVR').textContent = "VR 모드 종료";
            });
            
            renderer.xr.addEventListener('sessionend', () => {
                document.getElementById('info').textContent = "VR 모드가 종료되었습니다.\n다시 시작하려면 버튼을 누르세요.";
                document.getElementById('enterVR').textContent = "VR 모드 시작";
            });
            
            // 창 크기 조정 이벤트
            window.addEventListener('resize', onWindowResize);
            
            // 애니메이션 시작
            renderer.setAnimationLoop(render);
        }
        
        // 창 크기 변경 처리
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // 렌더링 함수
        function render() {
            renderer.render(scene, camera);
        }
        
        // 페이지 로드 시 초기화
        window.addEventListener('load', function() {
            if (checkXRSupport()) {
                initScene();
                
                // WebXR 세션 지원 확인
                navigator.xr.isSessionSupported('immersive-vr').then(supported => {
                    if (!supported) {
                        document.getElementById('unsupported').style.display = 'block';
                        document.getElementById('enterVR').style.display = 'none';
                        document.getElementById('info').style.display = 'none';
                    }
                });
            }
        });
    </script>
</body>
</html>
